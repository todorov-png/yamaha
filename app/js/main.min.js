"use strict";const header=document.querySelector(".header"),burgerMenu=header.querySelector(".menu-burger__header"),headerNav=header.querySelector(".header__nav"),headerItem=header.querySelectorAll(".header__item");null!==header&&(headerRendering(),window.addEventListener("resize",(function(e){headerRendering()})),burgerMenu.onclick=()=>{burgerMenu.classList.toggle("open-menu"),headerNav.classList.toggle("open-menu")});const userData=JSON.parse(localStorage.getItem("data_user"));if(null!==userData)updataUserData();else{const e=header.querySelector(".header__item-basket");null!==e&&(e.style.display="none")}function headerRendering(){header.offsetWidth>960?headerItem[0].style.width=headerItem[2].offsetWidth+"px":headerItem[0].style.width="auto",headerNav.style.top=header.offsetHeight+"px"}function updataUserData(){const e=header.querySelectorAll(".account-login"),t=header.querySelectorAll(".registration"),o=(header.querySelector(".header__item-basket"),JSON.parse(localStorage.getItem("data_basket"))),r=document.querySelector(".counter-basket-text");if(null!==e&&e.forEach(e=>{e.style.display="none"}),null!==t&&t.forEach(e=>{e.textContent="Мой аккаунт",e.setAttribute("href","javascript:void(0);"),e.setAttribute("onclick","goToMyAccount();")}),null!==o&&null!==r){let e=0;o.forEach(()=>{e++}),r.textContent=e}}function goToBasket(){const e=JSON.parse(localStorage.getItem("data_basket")),t=document.querySelector(".header__item-basket");if(null!==e){let o=0;e.forEach(()=>{o++}),o>0&&(document.location.href="http://yamahashop.zzz.com.ua/page/basket.html",t.setAttribute("href","http://yamahashop.zzz.com.ua/page/basket.html"))}else callPopUp("Ваша корзина пуста!")}function callPopUp(e){const t=document.createElement("div"),o=document.createElement("p"),r=document.querySelector("body"),a=document.querySelector(".pop-up-notification");null!==a&&a.remove(),t.classList.add("pop-up-notification"),o.classList.add("pop-up-notification__text"),o.textContent=e,o.zIndex=1e5,t.append(o),r.insertAdjacentElement("afterBegin",t),smoothTransparencyChange(t,1500,50)}function smoothTransparencyChange(e,t,o){let r=1;setTimeout(()=>{setTimeout((function t(){r<0?e.remove():(e.style.opacity=r,r-=.05,setTimeout(t,o))}),o)},t)}window.addEventListener("storage",()=>{updataUserData(),createTableBasket()});const tool=document.querySelectorAll(".tool-description__row"),hoverBtnTesting=document.querySelector(".registration-for-testing__text"),formTesting=document.querySelector(".registration-for-testing__form-wrapper");function showFormTests(){formTesting.style.display="flex",formTesting.style.opacity=1,tool[2].offsetWidth>480?formTesting.style.height=tool[2].offsetHeight+1+"px":formTesting.style.height=tool[1].offsetHeight+tool[2].offsetHeight+1+"px"}null!==hoverBtnTesting&&(hoverBtnTesting.addEventListener("mouseover",showFormTests),hoverBtnTesting.addEventListener("touchstart",showFormTests),window.addEventListener("resize",showFormTests)),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".registration-for-testing__form");null!==e&&e.addEventListener("submit",t=>{const o=new XMLHttpRequest,r=new FormData(e);t.preventDefault(),callPopUp("Записываю вашу заявку, подождите!"),o.open("POST","../php/mail.php"),o.send(r),o.addEventListener("load",()=>{if(200===o.status){callPopUp("Ваша заявка принята, ожидайте звонка!"),e.reset();let t=1;setTimeout(()=>{setTimeout((function e(){t<0?formTesting.style.display="none":(formTesting.style.opacity=t,t-=.05,setTimeout(e,50))}),50)},1e3)}else callPopUp("Произошла ошибка, попробуйте еще!")})})})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".form-reg-speed__form");null!==e&&e.addEventListener("submit",t=>{t.preventDefault();const o=new XMLHttpRequest,r=new FormData(e);callPopUp("Проверяю данные, подождите!"),o.open("POST","../php/registration_form.php"),o.send(r),o.addEventListener("load",()=>{200===o.status?JSON.parse(o.response)?(callPopUp("Регистрация прошла успешно!"),e.reset(),localStorage.setItem("data_user",o.response),setTimeout((function(){document.location.href="http://yamahashop.zzz.com.ua/"}),1e3)):callPopUp("Пользователь с таким email уже зарегистрирован, перейдите на страницу входа!"):callPopUp("Произошла ошибка, попробуйте еще!")})})})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".form-authorization__form");null!==e&&e.addEventListener("submit",t=>{t.preventDefault();const o=new XMLHttpRequest,r=new FormData(e);callPopUp("Проверяю данные, подождите!"),o.open("POST","../php/account_form.php"),o.send(r),o.addEventListener("load",()=>{if(200===o.status){const t=JSON.parse(o.response);t?t.password_status?(callPopUp("Авторизация прошла успешно!"),e.reset(),localStorage.setItem("data_user",o.response),setTimeout((function(){document.location.href="http://yamahashop.zzz.com.ua/"}),1e3)):callPopUp("Введён неверный пароль!"):callPopUp("Пользователь с таким email не найден!")}else callPopUp("Произошла ошибка, попробуйте еще!")})})}));const instruments=document.querySelectorAll(".instruments-item");function deleteProduct(e){const t=document.querySelector(".table-product").querySelector(`[data-id="${e}"]`),o=JSON.parse(localStorage.getItem("data_basket"));if(t.remove(),1!==o.length){const t=o.filter(t=>t.id!==e);console.log(t),costBasket(t),localStorage.setItem("data_basket",JSON.stringify(t))}else clearBasket()}function plusProductCounter(e){const t=document.querySelector(".table-product"),o=JSON.parse(localStorage.getItem("data_basket")),r=t.querySelector(`[data-id="${e}"]`),a=r.querySelector(".table-product__row-price"),n=r.querySelector(".table-product__row-amount").querySelector("span"),s=r.querySelector(".table-product__row-sum"),l=parseInt(a.innerText);let c=parseInt(n.innerText);c++,c>19&&(c=20,callPopUp("Максимальное количество товара 20!")),n.innerText=String(c),s.innerText=String(c*l),o.forEach(t=>{t.id===e&&(t.counter=c,t.sum=c*l)}),costBasket(o),localStorage.setItem("data_basket",JSON.stringify(o))}function minusProductCounter(e){const t=document.querySelector(".table-product"),o=JSON.parse(localStorage.getItem("data_basket")),r=t.querySelector(`[data-id="${e}"]`),a=r.querySelector(".table-product__row-price"),n=r.querySelector(".table-product__row-amount").querySelector("span"),s=r.querySelector(".table-product__row-sum"),l=parseInt(a.innerText);let c=parseInt(n.innerText);c--,c<1&&(c=1,callPopUp("Минимальное количество товара 1!")),n.innerText=String(c),s.innerText=String(c*l),o.forEach(t=>{t.id===e&&(t.counter=c,t.sum=c*l)}),costBasket(o),localStorage.setItem("data_basket",JSON.stringify(o))}function createTableBasket(){const e=document.querySelector(".basket"),t=JSON.parse(localStorage.getItem("data_basket"));if(null!==e&&null!==t&&t.length>0){let o=document.querySelector(".table-product"),r=document.querySelector(".form-product"),a=' <tr class="table-product__row">\n                            <th>Товар</th>\n                            <th>Цена</th>\n                            <th>Количество</th>\n                            <th>Сумма</th>\n                          </tr>',n='<p class="form-product__text">\n                          Сумма заказа: \n                          <span class="form-product__sum"></span>&nbsp;грн.\n                        </p>\n                        <button>Заказать</button>';t.forEach(e=>{a+=` <tr class="table-product__row" data-id="${e.id}">\n                      <td class="table-product__row-name">${e.name}</td>\n                      <td class="table-product__row-price">${e.price}</td>\n                      <td class="table-product__row-amount-wraper">\n                        <div class="table-product__row-amount">\n                          <a href="javascript:void(0);" onclick="minusProductCounter('${e.id}');"><i class="far fa-minus-square"></i></a>\n                          <span>${e.counter}</span>\n                          <a href="javascript:void(0);" onclick="plusProductCounter('${e.id}');"><i class="far fa-plus-square"></i></a>\n                        </div>\n                        </td>\n                      <td class="table-product__row-sum">${e.sum}</td>\n                      <td class="table-product__row-close">\n                        <a href="javascript:void(0);" onclick="deleteProduct('${e.id}');"><i class="fas fa-times"></i></a>\n                      </td>\n                    </tr>`}),null===o&&(o=document.createElement("table")),null===r&&(r=document.createElement("form")),o.classList.add("table-product"),r.classList.add("form-product"),o.innerHTML=a,r.innerHTML=n,e.append(o),e.append(r),document.querySelector(".basket__heading-text").innerText="Корзина",costBasket(t)}else null!==document.querySelector(".basket__heading-text")&&(document.querySelector(".basket__heading-text").innerText="Корзина пуста")}function costBasket(e){const t=document.querySelector(".form-product__sum");let o=0;e.forEach(e=>{o+=e.sum}),null!==t&&(t.innerText=String(o))}function clearBasket(){const e=document.querySelector(".table-product"),t=document.querySelector(".form-product");null!==t&&null!==e&&(e.remove(),t.remove(),localStorage.removeItem("data_basket"),document.querySelector(".basket__heading-text").innerText="Корзина пуста",callPopUp("Корзина пуста!"))}function goToMyAccount(){const e=JSON.parse(localStorage.getItem("data_user")),t=new XMLHttpRequest;null!==e?(t.open("POST","../php/history_of_orders.php"),t.setRequestHeader("Content-type","application/json; charset=utf-8"),t.send(JSON.stringify(e.email)),t.addEventListener("load",()=>{if(200===t.status){const e=JSON.parse(t.response);e&&(console.log(e),localStorage.setItem("data_history_of_orders",JSON.stringify(e))),document.location.href="http://yamahashop.zzz.com.ua/page/my_account.html"}else callPopUp("Произошла ошибка, попробуйте позже!")})):callPopUp("Авторизуйтесь для просмотра аккаунта!")}function signOut(){localStorage.clear(),document.location.href="http://yamahashop.zzz.com.ua"}function createTableHistory(){const e=document.querySelector(".account"),t=JSON.parse(localStorage.getItem("data_history_of_orders"));if(null!==e&&null!==t&&t.length>0){const o=document.querySelectorAll(".table-history-orders");null!==o&&o.forEach(e=>{e.remove()}),document.querySelector(".account__heading-text").innerText="История заказов",t.forEach(t=>{const o=document.createElement("table");let r=`<thead>\n                              <tr>\n                              <td class="table-history-orders__header">Заказ №${t[0]}</td>\n                              </tr>\n                            </thead>\n                            <tr class="table-history-orders__row">\n                              <th>Товар</th>\n                              <th>Цена</th>\n                              <th>Количество</th>\n                            </tr>`;t[1].forEach(e=>{r+=`<tr class="table-history-orders__row" data-id="${e.id}">\n                            <td class="table-history-orders__row-name">${e.name}</td>\n                            <td class="table-history-orders__row-price">${e.price}</td>\n                            <td class="table-history-orders__row-amount">${e.counter}</td>\n                          </tr>`}),o.classList.add("table-history-orders"),o.innerHTML=r,e.append(o)})}else null!==document.querySelector(".account__heading-text")&&(document.querySelector(".account__heading-text").innerText="История заказов пуста")}null!==instruments&&instruments.forEach(e=>{e.addEventListener("mouseover",()=>{e.querySelector(".instruments-item__hover-text").style.display="block"}),e.addEventListener("mouseout",()=>{e.querySelector(".instruments-item__hover-text").style.display="none"}),e.addEventListener("click",()=>{const t=JSON.parse(localStorage.getItem("data_user")),o=document.querySelector(".counter-basket-text");if(null!==t){let t=JSON.parse(localStorage.getItem("data_basket")),r=e.getAttribute("data-id");const a=parseInt(e.querySelector("p").textContent);if(null===t)t=[{id:r,name:e.querySelector("h4").textContent,price:a,counter:1,sum:a}],localStorage.setItem("data_basket",JSON.stringify(t)),o.textContent=parseInt(o.textContent)+1,callPopUp("Товар добавлен в корзину!");else{let n=0;t.forEach(e=>{e.id===r&&n++}),0===n?(t.push({id:r,name:e.querySelector("h4").textContent,price:a,counter:1,sum:a}),localStorage.setItem("data_basket",JSON.stringify(t)),o.textContent=parseInt(o.textContent)+1,callPopUp("Товар добавлен в корзину!")):callPopUp("Вы уже добавили этот товар в корзину!")}}else callPopUp("Для добавления в корзину необходимо авторизоваться!")})}),createTableBasket(),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".form-product");null!==e&&e.addEventListener("submit",e=>{e.preventDefault();let t={},o="[";const r=JSON.parse(localStorage.getItem("data_basket")),a=JSON.parse(localStorage.getItem("data_user")),n=new XMLHttpRequest;null!==a&&null!==r&&(r.forEach(e=>{o+=`{"id":"${e.id}","name":"${e.name}","price":"${e.price}","counter":"${e.counter}"},`}),o=o.substring(0,o.length-1)+"]",t.email=a.email,t.tools=JSON.parse(o)),n.open("POST","../php/basket.php"),n.setRequestHeader("Content-type","application/json; charset=utf-8"),n.send(JSON.stringify(t)),n.addEventListener("load",()=>{200===n.status?(clearBasket(),callPopUp("Заказ принят, ожидайте, мы с вами свяжемся!")):callPopUp("Произошла ошибка, попробуйте еще!")})})})),createTableHistory();